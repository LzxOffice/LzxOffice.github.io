<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LzxAI</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入Markdown解析库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
    
    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        neutral: '#64748B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .btn-active {
                @apply bg-primary text-white;
            }
            .markdown-body {
                font-size: 0.875rem;
                line-height: 1.5;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm py-4">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <i class="fa fa-brain text-primary text-2xl"></i>
                    <h1 class="text-xl font-bold text-gray-800">LzxAI —— LzxOffce 开发的先进 AI</h1>
                </div>
                
                <nav class="hidden-sm:hidden">
                    <ul class="flex space-x-6">
                        <li><a href="https://lzxoffice.github.io" class="text-gray-600 hover:text-primary transition-colors">访问官网</a></li>
                        <li><a href="https://lzxoffice.github.io/download/ai" class="text-gray-600 hover:text-primary transition-colors">下载电脑端</a></li>
                    </ul>
                </nav>
                
                <button class="sm:hidden text-gray-600" id="menuToggle">
                    <i class="fa fa-bars text-xl"></i>
                </button>
            </div>
            
            <!-- 移动端菜单 -->
            <div id="mobileMenu" class="hidden sm:hidden mt-4 pb-2">
                <ul class="space-y-3">
                    <li><a href="#" class="block text-gray-600 hover:text-primary transition-colors">首页</a></li>
                    <li><a href="#about" class="block text-gray-600 hover:text-primary transition-colors">关于</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">
        
        
        <!-- 聊天界面 -->
        <section class="mb-12 bg-white rounded-xl shadow-md overflow-hidden border border-gray-100">
            <!-- 服务选择栏 -->
            <div class="p-4 border-b border-gray-100 bg-gray-50 flex flex-wrap gap-2 items-center">
                <span class="text-sm text-gray-500 whitespace-nowrap">服务类型:</span>
                
                <!-- 服务类型按钮 -->
                <button class="service-type-btn px-3 py-1.5 rounded-md text-sm border transition-all hover:border-primary btn-active" data-type="text">
                    <i class="fa fa-file-text-o mr-1"></i>文本生成
                </button>
                <button class="service-type-btn px-3 py-1.5 rounded-md text-sm border border-gray-300 text-gray-700 transition-all hover:border-primary hover:text-primary" data-type="image">
                    <i class="fa fa-picture-o mr-1"></i>图像生成
                </button>
                
                <!-- 模型选择 (默认隐藏，文本生成时显示) -->
                <div class="ml-4 flex items-center gap-2" id="modelSelector">
                    <span class="text-sm text-gray-500 whitespace-nowrap">模型:</span>
                    <button class="model-btn px-3 py-1.5 rounded-md text-sm border transition-all hover:border-primary btn-active" data-service="glm4">
                        智谱 AI GLM-4-Flash
                    </button>
                    <button class="model-btn px-3 py-1.5 rounded-md text-sm border border-gray-300 text-gray-700 transition-all hover:border-primary hover:text-primary" data-service="pollinations-text">
                        Pollinations
                    </button>
                </div>
                
                <!-- 图像模型选择 (默认隐藏，图像生成时显示) -->
                <div class="ml-4 flex items-center gap-2 hidden" id="imageModelSelector">
                    <span class="text-sm text-gray-500 whitespace-nowrap">模型:</span>
                    <button class="model-btn px-3 py-1.5 rounded-md text-sm border transition-all hover:border-primary btn-active" data-service="pollinations-image">
                        Pollinations
                    </button>
                </div>
            </div>
            
            <!-- 聊天消息区域 -->
            <div id="chatMessages" class="h-[450px] overflow-y-auto p-4 space-y-4">
                <!-- 系统提示 -->
                <div class="flex items-start space-x-2">
                    <div class="w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i class="fa fa-info text-gray-600 text-xs"></i>
                    </div>
                    <div class="bg-gray-100 rounded-lg rounded-tl-none px-3 py-2 max-w-[85%] text-sm text-gray-700">
                        我是 LzxAI，很高兴见到你！
                    </div>
                </div>
            </div>
            
            <!-- 输入区域 -->
            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <div class="flex gap-2">
                    <textarea id="userInput" rows="2" placeholder="请输入你的问题" class="flex-grow px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary resize-none text-sm"></textarea>
                    <button id="sendButton" class="bg-primary hover:bg-primary/90 text-white p-2.5 rounded-lg shadow-sm hover:shadow transition-all flex items-center justify-center">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
                <p id="statusMessage" class="text-xs text-gray-500 mt-2 hidden"></p>
            </div>
        </section>
        
        
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-gray-400 py-6 text-sm">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 LzxAI 平台</p>
        </div>
    </footer>

    <!-- 脚本 -->
    <script>
        const API_CONFIG = {
            glm4: {
                name: "智谱AI GLM-4-Flash",
                endpoint: "https://open.bigmodel.cn/api/paas/v4/chat/completions",
                apiKey: "cc153b06cc1740e489aaa143e4c0a30d.dB64GZ1WEedC4ahh",   
                model: "glm-4-flash",
                type: "text"
            },
            "pollinations-text": {
                name: "Pollinations (文本)",
                endpoint: "https://text.pollinations.ai/",
                apiKey: "",  
                model: "",
                type: "text"
            },
            "pollinations-image": {
                name: "Pollinations (图像)",
                endpoint: "https://image.pollinations.ai/prompt/",
                apiKey: "", 
                model: "",
                type: "image"
            }
        };
        let currentService = "glm4";
        let currentType = "text";
        let conversationHistory = [];
        
        // DOM元素
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        const sendButton = document.getElementById('sendButton');
        const userInput = document.getElementById('userInput');
        const chatMessages = document.getElementById('chatMessages');
        const statusMessage = document.getElementById('statusMessage');
        const serviceTypeBtns = document.querySelectorAll('.service-type-btn');
        const modelBtns = document.querySelectorAll('.model-btn');
        const modelSelector = document.getElementById('modelSelector');
        const imageModelSelector = document.getElementById('imageModelSelector');
        
        // 移动端菜单切换
        menuToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // 服务类型切换
        serviceTypeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.getAttribute('data-type');
                currentType = type;
                
                // 更新按钮样式
                serviceTypeBtns.forEach(b => {
                    b.classList.remove('btn-active', 'border-primary');
                    b.classList.add('border-gray-300', 'text-gray-700');
                });
                btn.classList.add('btn-active', 'border-primary');
                btn.classList.remove('border-gray-300', 'text-gray-700');
                
                // 显示对应的模型选择器
                if (type === 'text') {
                    modelSelector.classList.remove('hidden');
                    imageModelSelector.classList.add('hidden');
                    // 切换到第一个文本模型
                    currentService = "glm4";
                    updateModelButtons();
                    userInput.placeholder = "请输入您的问题";
                } else {
                    modelSelector.classList.add('hidden');
                    imageModelSelector.classList.remove('hidden');
                    // 切换到图像模型
                    currentService = "pollinations-image";
                    updateModelButtons();
                    userInput.placeholder = "请描述描述您想要生成的图像";
                }
                
                // 添加系统消息提示
                const typeText = type === 'text' ? '文本生成' : '图像生成';
                addMessage(`已切换到${typeText}服务`, false);
                
                // 重置对话历史
                conversationHistory = [];
            });
        });
        
        // 模型选择
        modelBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                currentService = btn.getAttribute('data-service');
                updateModelButtons();
                
                // 添加系统消息提示
                addMessage(`已选择模型: ${API_CONFIG[currentService].name}`, false);
            });
        });
        
        // 更新模型按钮状态
        function updateModelButtons() {
            modelBtns.forEach(btn => {
                if (btn.getAttribute('data-service') === currentService) {
                    btn.classList.add('btn-active', 'border-primary');
                    btn.classList.remove('border-gray-300', 'text-gray-700');
                } else {
                    btn.classList.remove('btn-active', 'border-primary');
                    btn.classList.add('border-gray-300', 'text-gray-700');
                }
            });
        }
        
        // 添加消息到聊天界面
        function addMessage(content, isUser = false, isImage = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex items-start space-x-2 animate-fadeIn`;
            
            const avatarClass = isUser ? 
                'bg-primary text-white' : 
                (isImage ? 'bg-accent text-white' : 'bg-gray-200 text-gray-600');
            
            const messageBubbleClass = isUser ? 
                'bg-primary text-white rounded-lg rounded-tr-none' : 
                'bg-gray-100 text-gray-700 rounded-lg rounded-tl-none';
            
            // 对于非图片、非用户的消息，使用Markdown渲染
            let messageContent = content;
            if (!isImage && !isUser) {
                // 使用marked库将Markdown转换为HTML
                messageContent = marked.parse(content);
            }
            
            messageDiv.innerHTML = `
                <div class="w-7 h-7 rounded-full ${avatarClass} flex items-center justify-center flex-shrink-0 mt-0.5">
                    <i class="fa ${isUser ? 'fa-user' : (isImage ? 'fa-picture-o' : 'fa-robot')} text-xs"></i>
                </div>
                <div class="${messageBubbleClass} px-3 py-2 max-w-[85%] text-sm ${!isImage && !isUser ? 'markdown-body' : ''}">
                    ${isImage ? 
                        `<img src="${content}" alt="AI生成的图像" class="rounded-lg max-w-full h-auto">` : 
                        messageContent
                    }
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // 如果是用户消息或AI回复，添加到对话历史（图像生成不保存历史）
            if (content && (isUser || (!isImage && API_CONFIG[currentService].type === 'text'))) {
                conversationHistory.push({
                    role: isUser ? "user" : "assistant",
                    content: content
                });
            }
        }
        
        // 显示状态消息
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'text-red-500', 'text-green-500');
            statusMessage.classList.add(isError ? 'text-red-500' : 'text-green-500');
        }
        
        // 隐藏状态消息
        function hideStatus() {
            statusMessage.classList.add('hidden');
        }
        
        // 发送消息处理
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // 获取当前服务的配置
            const config = API_CONFIG[currentService];
            
            // 添加用户消息（用户输入保持原样显示，不进行Markdown渲染）
            addMessage(message, true);
            userInput.value = '';
            
            // 显示发送状态
            const actionText = config.type === 'text' ? '生成文本' : '生成图像';
            showStatus(`正在${actionText}...`);
            
            try {
                let aiResponse;
                
                // Pollinations文本生成
                if (currentService === 'pollinations-text') {
                    const encodedPrompt = encodeURIComponent(message);
                    const url = `${config.endpoint}${encodedPrompt}`;
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);
                    
                    aiResponse = await response.text();
                    addMessage(aiResponse);
                }
                // Pollinations图像生成
                else if (currentService === 'pollinations-image') {
                    const encodedPrompt = encodeURIComponent(message);
                    // 添加一些参数改善图像质量
                    const imageUrl = `${config.endpoint}${encodedPrompt}?width=800&height=600&nologo=true`;
                    
                    // 直接显示图片
                    addMessage(imageUrl, false, true);
                    aiResponse = '图像生成成功';
                }
                // 智谱AI处理
                else if (currentService === 'glm4') {
                    // 检查API Key是否已配置
                    if (!config.apiKey || config.apiKey.includes('YOUR_')) {
                        throw new Error('API Key未配置，请在代码中设置正确的API Key');
                    }
                    
                    // 创建一个临时元素显示"正在输入..."
                    const typingIndicator = document.createElement('div');
                    typingIndicator.id = 'typingIndicator';
                    typingIndicator.className = `flex items-start space-x-2`;
                    typingIndicator.innerHTML = `
                        <div class="w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fa fa-robot text-gray-600 text-xs"></i>
                        </div>
                        <div class="bg-gray-100 rounded-lg rounded-tl-none px-3 py-2 max-w-[85%] text-sm text-gray-700">
                            <p>正在生成文本...</p>
                        </div>
                    `;
                    chatMessages.appendChild(typingIndicator);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    const response = await fetch(config.endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${config.apiKey}`
                        },
                        body: JSON.stringify({
                            model: config.model,
                            messages: [
                                ...conversationHistory.filter(item => item.role !== 'assistant'),
                                { role: 'user', content: message }
                            ],
                            temperature: 0.7
                        })
                    });
                    
                    // 移除"正在输入..."提示
                    document.getElementById('typingIndicator').remove();
                    
                    if (!response.ok) {
                        const errorDetails = await response.text();
                        throw new Error(`API错误: ${response.status} - ${errorDetails}`);
                    }
                    
                    const data = await response.json();
                    aiResponse = data.choices?.[0]?.message?.content || 
                                data.content || 
                                '未获取到有效响应';
                    
                    addMessage(aiResponse);
                }
                
                showStatus(`${actionText}成功`, false);
                setTimeout(hideStatus, 3000);
                
            } catch (error) {
                console.error('API请求错误:', error);
                // 移除可能存在的"正在输入..."提示
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) typingIndicator.remove();
                
                addMessage(`请求失败: ${error.message}`, false);
                showStatus(`请求失败: ${error.message}`, true);
            }
        }
        
        // 发送按钮点击事件
        sendButton.addEventListener('click', sendMessage);
        
        // 回车键发送消息
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // 添加平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop,
                        behavior: 'smooth'
                    });
                    
                    // 关闭移动菜单（如果打开）
                    if (!mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
            });
        });
    </script>
</body>
</html>
